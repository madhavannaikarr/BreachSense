<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dark Web Intel â€” Advanced Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    /* * --- GLOBAL STYLES --- */
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#6ee7b7; --danger:#ff6b6b; --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02);
    }
    html,body{
        height:100%;
        margin:0;
        font-family:'Times New Roman', serif; 
        background:linear-gradient(180deg,#071021 0%, #0f1724 100%);
        color:#e6eef6;
        font-size: 16px;
    }
    .wrap{max-width:1400px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:24px;margin-bottom:24px}
    .logo{
        width:72px;height:72px;border-radius:14px;
        background:linear-gradient(135deg,#00b0ff,#003cff);
        display:flex;align-items:center;justify-content:center;
        font-weight:800;
        font-size: 32px;
        color:#fff;
        box-shadow:0 8px 30px rgba(0, 50, 200, 0.7);
        border: 2px solid #fff;
    }
    h1{font-size:36px;margin:0;font-weight:700}
    p.lead{margin:0;color:var(--muted);font-size:18px}

    /* cards row */
    .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-top:20px;margin-bottom:30px}
    .card{background:linear-gradient(180deg,var(--card), rgba(255,255,255,0.02));padding:20px;border-radius:16px;box-shadow:0 8px 25px rgba(2,6,23,0.8);border:1px solid var(--glass)}
    .card .label{font-size:16px;color:var(--muted);font-weight: bold;}
    .card .value{font-size:48px;font-weight:800;margin-top:10px}

    /* layout main */
    .grid{display:grid;grid-template-columns: 1fr 480px;gap:24px}
    .panel{background:var(--card);padding:20px;border-radius:16px;border:1px solid var(--glass)}
    .panel h3{margin:0 0 15px 0;font-size:24px}
    .searchbar{display:flex;gap:12px;align-items:center;margin-bottom:15px}
    input.search, select.sort{
        flex:1;padding:12px 16px;border-radius:10px;
        border:1px solid var(--glass-2);
        background:transparent;color:inherit;
        font-size: 16px;
    }

    /* table */
    table{width:100%;border-collapse:collapse;color:#e6eef6;font-size: 16px;}
    thead th{font-size:14px;text-align:left;padding:15px 10px;background:linear-gradient(180deg, rgba(255,255,255,0.04), transparent);border-bottom:2px solid rgba(255,255,255,0.08)}
    tbody td{padding:15px 10px;border-bottom:1px dashed rgba(255,255,255,0.03);vertical-align:middle}
    .email{font-weight:700;color:#cfeffd;font-size: 18px;}
    .muted{color:var(--muted);font-size:15px}

    /* micro percentage bar */
    .microbar{height:10px;background:linear-gradient(90deg,#1f2937,#0b1220);border-radius:8px;overflow:hidden}
    .microbar > i{display:block;height:100%;background:linear-gradient(90deg,#60a5fa,#2dd4bf);width:0%;transition:width 700ms cubic-bezier(.2,.9,.2,1)}

    /* * --- RICH TOOLTIP/CARD STYLES --- */
    .tooltip{
      position:fixed;pointer-events:none;z-index:9999;
      padding:16px;border-radius:14px;
      background:rgba(3,7,18,0.95);
      color:#dff7ff;
      box-shadow:0 15px 40px rgba(0,0,0,0.8);
      max-width:380px;
      font-size:16px;
      border:2px solid var(--accent);
      transform-origin:left top;
      opacity:0;
      transform: scale(0.9);
      transition:transform .12s ease,opacity .12s ease;
    }
    .tooltip-header{
        font-size: 20px; 
        font-weight:800; 
        margin-bottom: 8px; 
        color: var(--accent);
    }
    .tooltip-breach-list{
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px dashed rgba(255,255,255,0.1);
    }
    .tooltip-breach-item{
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 15px;
    }
    .tooltip-breach-item span{
        margin-right: 12px;
        font-size: 22px; /* Bigger Icon Size */
        line-height: 1;
    }
    .tooltip-breach-item div{
        flex: 1;
        font-weight: 700;
        color: #fff;
    }
    .tooltip-breach-item small{
        color: var(--muted);
        font-size: 13px;
        margin-left: 10px;
    }

    /* congratulations Popper (Static part) */
    .congrats{
      position:fixed;left:50%;top:12%;
      transform:translateX(-50%) scale(0.9);
      background:linear-gradient(90deg,#06b6d4,#60a5fa);
      color:#022;padding:24px 32px;
      border-radius:16px;
      box-shadow:0 30px 80px rgba(8,12,24,0.8);
      display:flex;align-items:center;gap:16px;
      z-index:9998;opacity:0;pointer-events:none;
      transition:opacity .3s ease,transform .3s ease;
    }
    .congrats.show{opacity:1;pointer-events:auto;transform:translateX(-50%) scale(1)}
    .congrats .tick{
        background:#022;padding:12px;border-radius:12px;
        color:var(--accent);font-weight:800;font-size: 24px;
    }
    .congrats > div > div{ font-size: 18px; }

    /* Confetti Canvas - Must be full screen and behind the Popper */
    #confetti-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9997; /* Below the popper (9998) */
    }

    /* responsive */
    @media (max-width:1200px){
        .grid{grid-template-columns:1fr; }
        .cards{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:768px){
        .logo{width:56px;height:56px;font-size:24px;}
        h1{font-size:28px;}
        .card .value{font-size:36px;}
        .cards{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  
  <canvas id="confetti-canvas"></canvas>

  <div class="wrap">
    <header>
      <div class="logo">
        &#128165; 
      </div>
      <div>
        <h1>BreachSense </h1>
        <p class="lead">Click on an email to see full details.</p>
      </div>
    </header>

    <div class="cards" id="cards">
      <div class="card">
        <div class="label">Total Checked Accounts</div>
        <div class="value" id="card-checked">â€”</div>
      </div>
      <div class="card">
        <div class="label">Accounts With Breaches</div>
        <div class="value" id="card-leaked">â€”</div>
      </div>
      <div class="card">
        <div class="label">Safe Percentage</div>
        <div class="value" id="card-safe">â€”</div>
      </div>
      <div class="card">
        <div class="label">Most Common Source</div>
        <div class="value" id="card-topsource">â€”</div>
      </div>
    </div>

    <div class="grid">
      <div>
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center; flex-wrap: wrap;">
            <h3>Detected Email Breaches</h3>
            <div style="display:flex;gap:12px;align-items:center">
              <input class="search" id="search" placeholder="Search email or source..." />
              <select class="sort" id="sort">
                <option value="leaks_desc">Sort: Leaks (highâ†’low)</option>
                <option value="leaks_asc">Sort: Leaks (lowâ†’high)</option>
                <option value="alpha">Sort: Email (Aâ†’Z)</option>
              </select>
            </div>
          </div>

          <table id="emailsTable">
            <thead>
              <tr>
                <th>Account & Name</th>
                <th>Total Leaks</th>
                <th>Top Sources</th>
                <th>Risk Score</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="right">
        <div class="panel" style="margin-bottom:16px">
          <h3>Summary Charts</h3>
          <div class="right-charts" style="display:flex;gap:16px;flex-direction:column">
            <div class="chart-box" style="height:300px;"><canvas id="barChart" style="max-width:100%"></canvas></div>
            <div style="display:flex;gap:16px;align-items:center; flex-wrap: wrap;">
              <div style="flex:1; min-width: 150px;">
                <div class="chart-box" style="height:200px;"><canvas id="donutChart"></canvas></div>
              </div>
              <div style="width:180px">
                <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">Top 5 Sources</div>
                <div class="muted">Emails per source:</div>
                <div style="margin-top:12px" id="top-sources-list"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h3>Details</h3>
          <div class="muted" id="explain">Hover over any email row to see full breach sources, names, and location details.</div>
        </div>
      </div>
    </div>
  </div>

  <div id="tooltip" class="tooltip"></div>
  
  <div id="congrats" class="congrats">
    <div class="tick">âœ”</div>
    <div>
      <div style="font-weight:800; font-size: 20px;">CONGRATULATIONS!</div>
      <div class="muted" style="color:#022;">You have 0 breaches!!!</div>
    </div>
  </div>
<script>
Â  // --- Configuration Mappings for Rich Data ---
Â  // 1. Simple Name -> Full Name (Guesses based on email format)
Â  function guessName(email) {
Â  Â  if (!email) return "Name Not Found";
Â  Â  // Tries to convert 'first.last@domain.com' to 'First Last'
Â  Â  const userPart = email.split('@')[0];
Â  Â  const parts = userPart.split(/[._-]/); // Split by common separators
Â  Â  const name = parts.map(p => p.charAt(0).toUpperCase() + p.slice(1)).join(' ');
Â  Â  // Fallback if the name is still unformatted (e.g., 'drkalbande' -> 'Drkalbande')
Â  Â  return name || "N/A";
Â  }

Â  // 2. Breach Source Name -> Rich Data (Location, Icon/Logo)
Â  // Icons use Unicode/Emoji as a replacement for image files
Â  const SOURCE_MAPPING = {
Â  Â  // Common Examples
Â  Â  "TrueCaller India": { location: "India", icon: "ðŸ‡®ðŸ‡³" },
Â  Â  "LuminPDF.com": { location: "Worldwide", icon: "ðŸ“„" },
Â  Â  "Twitter.com (scraping data)": { location: "USA (Social)", icon: "ðŸ¦" },
Â  Â  "Chegg.com": { location: "Education", icon: "ðŸ“š" },
Â  Â  "Bigbasket.com": { location: "India (E-commerce)", icon: "ðŸ›’" },
Â  Â  "Facebook": { location: "Social Media", icon: "ðŸ‘¤" },
Â  Â  "LinkedIn": { location: "Professional", icon: "ðŸ’¼" },
Â  Â  "Canva": { location: "Design Tool", icon: "ðŸ–¼ï¸" },
Â  Â  "Adobe": { location: "Software", icon: "ðŸŽ¨" },
Â  Â  "Gethub": { location: "Code Repository", icon: "ðŸ’»" },
Â  Â  // Default fallback
Â  Â  "Default": { location: "Unknown Global Location", icon: "â“" }
Â  };

Â  // Helper: fetch JSON file (same folder)
Â  async function loadResults() {
Â  Â  try {
Â  Â  Â  // NOTE: This path is hardcoded from the original HTML
Â  Â  Â  const res = await fetch("out/leak_results.json");
Â  Â  Â  if (!res.ok) throw new Error("File not found: out/leak_results.json");
Â  Â  Â  const data = await res.json();
Â  Â  Â  return data;
Â  Â  } catch (e) {
Â  Â  Â  console.error(e);
Â  Â  Â  alert("Could not load out/leak_results.json. Ensure it's in the 'out' folder and contains valid JSON data with unmasked emails.");
Â  Â  Â  throw e;
Â  Â  }
Â  }

Â  // Animate microbars
Â  function setBar(el, pct){
Â  Â  const inner = el.querySelector("i");
Â  Â  requestAnimationFrame(()=> inner.style.width = pct + "%");
Â  }

Â  // --- Confetti Logic ---
Â  const confettiCanvas = document.getElementById('confetti-canvas');
Â  const myConfetti = confetti.create(confettiCanvas, { resize: true, useWorker: true });

Â  function fireConfetti() {
Â  Â  // Fire a barrage of confetti from the center top
Â  Â  myConfetti({
Â  Â  Â  particleCount: 200,
Â  Â  Â  spread: 120,
Â  Â  Â  origin: { x: 0.5, y: 0.1 },
Â  Â  Â  colors: ['#00b0ff', '#6ee7b7', '#fff', '#ff6b6b'] // Custom colors
Â  Â  });

Â  Â  // Fire another smaller, tighter burst
Â  Â  myConfetti({
Â  Â  Â  particleCount: 50,
Â  Â  Â  spread: 60,
Â  Â  Â  origin: { x: 0.5, y: 0.1 },
Â  Â  Â  scalar: 0.8,
Â  Â  Â  shapes: ['star'],
Â  Â  Â  colors: ['#003cff', '#06b6d4']
Â  Â  });
Â  }

Â  // Helper for individual congratulations pop-up
Â  const congratsPopper = document.getElementById("congrats");
Â  function showIndividualCongrats() {
Â  Â  congratsPopper.classList.add("show");
Â  Â  fireConfetti();
Â  Â  setTimeout(() => congratsPopper.classList.remove("show"), 5000); // Shorter timeout for individual congrats
Â  }


Â  // --- Tooltip management: FIXED CARD POSITIONING ON CLICK ---
Â  const tooltip = document.getElementById("tooltip");
Â  let lastClickedRow = null; // Track the last row clicked

Â  function showRichTooltip(r, event) {
Â  Â  
Â  Â  // Find the closest table row (<tr>)
Â  Â  const row = event.target.closest("tr");
Â  Â  if (!row) return; 

Â  Â  // If the same row is clicked again, toggle the tooltip off
Â  Â  if (row === lastClickedRow && tooltip.style.opacity === "1") {
Â  Â  Â  hideTooltip();
Â  Â  Â  lastClickedRow = null;
Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  lastClickedRow = row;
Â  Â  const emailCell = row.querySelector('td:first-child');
Â  Â  if (!emailCell) return;
Â  Â  const cellRect = emailCell.getBoundingClientRect();
Â  Â  
Â  Â  // 1. Map simple source names to rich objects
Â  Â  const richSources = r.sources.map(sourceName => {
Â  Â  Â  Â  const mapping = SOURCE_MAPPING[sourceName] || SOURCE_MAPPING.Default;
Â  Â  Â  Â  return { 
Â  Â  Â  Â  Â  Â  name: sourceName, 
Â  Â  Â  Â  Â  Â  location: mapping.location, 
Â  Â  Â  Â  Â  Â  icon: mapping.icon 
Â  Â  Â  Â  };
Â  Â  });

Â  Â  let sourcesHtml = '';
Â  Â  if (r.found > 0 && richSources.length > 0) {
Â  Â  Â  Â  sourcesHtml = `<div class="tooltip-breach-list">
Â  Â  Â  Â  Â  Â  <div style="font-weight:700; margin-bottom: 8px; color: var(--danger);">Breach Locations (${r.found} Total):</div>
Â  Â  Â  Â  Â  Â  ${richSources.map(s => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="tooltip-breach-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${s.icon}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>${s.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small>${s.location}</small>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  </div>`;
Â  Â  } else {
Â  Â  Â  Â  sourcesHtml = '<div style="color:var(--accent); font-weight:700; margin-top: 10px;">âœ… No breaches found in our database.</div>';
Â  Â  Â  Â  // Trigger confetti/congrats for individual 0-breach email on hover
Â  Â  Â  Â  showIndividualCongrats();
Â  Â  }

Â  Â  const html = `
Â  Â  Â  Â  <div class="tooltip-header">${r.email}</div>
Â  Â  Â  Â  <div class="muted" style="margin-bottom: 10px;">${r.name}</div>
Â  Â  Â  Â  ${sourcesHtml}
Â  Â  `;

Â  Â  tooltip.innerHTML = html;
Â  Â  
Â  Â  // Position the tooltip logic using requestAnimationFrame for better performance before size check
Â  Â  requestAnimationFrame(() => {
Â  Â  Â  Â  // Set initial horizontal position anchored to the left of the email cell
Â  Â  Â  Â  tooltip.style.left = (cellRect.left + window.scrollX) + "px";
Â  Â  Â  Â  
Â  Â  Â  Â  // Temporarily show it to calculate its size accurately
Â  Â  Â  Â  tooltip.style.opacity = 1;
Â  Â  Â  Â  tooltip.style.transform = "scale(1)";

Â  Â  Â  Â  const tooltipRect = tooltip.getBoundingClientRect();
Â  Â  Â  Â  const viewportWidth = window.innerWidth;
Â  Â  Â  Â  const viewportHeight = window.innerHeight;
Â  Â  Â  Â  
Â  Â  Â  Â  // Vertical Positioning Fix (Scroll visibility)
Â  Â  Â  Â  
Â  Â  Â  Â  // Calculate position if placed BELOW the row (10px offset)
Â  Â  Â  Â  let desiredTop = cellRect.bottom + 10 + window.scrollY;
Â  Â  Â  Â  
Â  Â  Â  Â  // Calculate how far the bottom of the tooltip would be from the top of the viewport
Â  Â  Â  Â  let tooltipBottomInView = (cellRect.bottom + 10 + tooltipRect.height);

Â  Â  Â  Â  // Check if the tooltip goes past the bottom edge of the viewport
Â  Â  Â  Â  if (tooltipBottomInView > viewportHeight) {
Â  Â  Â  Â  Â  Â  // Option 1: Flip UPWARDS (anchor to the top of the row, minus height and offset)
Â  Â  Â  Â  Â  Â  let topFlipped = cellRect.top - tooltipRect.height - 10 + window.scrollY;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // If flipping up is still below the top of the viewport (i.e., not off the top), use it
Â  Â  Â  Â  Â  Â  if (topFlipped > window.scrollY) {
Â  Â  Â  Â  Â  Â  Â  Â  desiredTop = topFlipped;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Option 2: If both above and below are problematic, just put it at the bottom of the view
Â  Â  Â  Â  Â  Â  Â  Â  desiredTop = (viewportHeight - tooltipRect.height - 10) + window.scrollY;
Â  Â  Â  Â  Â  Â  Â  Â  if (desiredTop < 0) desiredTop = 10; // safety minimum
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  tooltip.style.top = desiredTop + "px";

Â  Â  Â  Â  // Horizontal Positioning Fix (Right side)
Â  Â  Â  Â  if (tooltipRect.right > viewportWidth) {
Â  Â  Â  Â  Â  Â  // If it goes off screen, shift it left by the amount it overflowed, plus a small margin
Â  Â  Â  Â  Â  Â  const overflow = tooltipRect.right - viewportWidth;
Â  Â  Â  Â  Â  Â  let newLeft = (cellRect.left + window.scrollX) - overflow - 10;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Ensure it doesn't shift off the left side
Â  Â  Â  Â  Â  Â  if (newLeft < 0) newLeft = 10; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  tooltip.style.left = newLeft + 'px';
Â  Â  Â  Â  }
Â  Â  });
Â  }
Â  
Â  function hideTooltip(){ 
Â  Â  tooltip.style.opacity = 0; 
Â  Â  tooltip.style.transform = "scale(.9)"; // Consistent hide scale
Â  }

Â  // Close tooltip when clicking outside the table or tooltip itself
Â  document.addEventListener("click", (e) => {
Â  Â  if (e.target.closest("#emailsTable") === null && e.target.closest("#tooltip") === null) {
Â  Â  Â  hideTooltip();
Â  Â  Â  lastClickedRow = null;
Â  Â  }
Â  });


Â  // Render table and charts
Â  (async function(){
Â  Â  let raw;
Â  Â  try {
Â  Â  Â  Â  raw = await loadResults();
Â  Â  } catch {
Â  Â  Â  Â  return; // Stop execution if data load fails
Â  Â  }

Â  Â  // Process results: add the name field
Â  Â  const results = raw.map(r => ({
Â  Â  Â  Â  email: r.email,
Â  Â  Â  Â  name: guessName(r.email), // Add guessed name
Â  Â  Â  Â  found: Number(r.found || 0),
Â  Â  Â  Â  sources: r.sources || []
Â  Â  }));

Â  Â  // --- Summary Calculations ---
Â  Â  const total = results.length;
Â  Â  const leakedCount = results.filter(r=>r.found>0).length;
Â  Â  const safePct = total > 0 ? Math.round(((total - leakedCount) / total) * 100) : 0;
Â  Â  
Â  Â  const topSourceCounts = {};
Â  Â  results.forEach(r => r.sources.forEach(sourceName=>{
Â  Â  Â  topSourceCounts[sourceName] = (topSourceCounts[sourceName]||0) + 1;
Â  Â  }));
Â  Â  const topSources = Object.entries(topSourceCounts).sort((a,b)=>b[1]-a[1]).slice(0,5);

Â  Â  // --- Update Cards ---
Â  Â  document.getElementById("card-checked").textContent = total;
Â  Â  document.getElementById("card-leaked").textContent = leakedCount;
Â  Â  document.getElementById("card-safe").textContent = safePct + "%";
Â  Â  document.getElementById("card-topsource").textContent = topSources[0] ? topSources[0][0] : "None";

Â  Â  // --- Conditional Popper & Confetti (Global 0 Leaks) ---
Â  Â  if (leakedCount === 0 && total > 0) {
Â  Â  Â  // Note: congratsPopper is defined globally above
Â  Â  Â  congratsPopper.classList.add("show");
Â  Â  Â  fireConfetti(); // FIRE CONFETTI
Â  Â  Â  setTimeout(()=> congratsPopper.classList.remove("show"), 8000); 
Â  Â  }

Â  Â  // --- Table Rendering Logic (Initial/Rerender) ---
Â  Â  const tbody = document.querySelector("#emailsTable tbody");
Â  Â  const maxFound = Math.max(1, ...results.map(r=>r.found));
Â  Â  
Â  Â  // Function to render/rerender the table rows
Â  Â  const renderTableRows = (data) => {
Â  Â  Â  Â  tbody.innerHTML = "";
Â  Â  Â  Â  data.forEach((r, idx) => {
Â  Â  Â  Â  Â  Â  const tr = document.createElement("tr");
Â  Â  Â  Â  Â  Â  // Assign the result object to the row element for easy access in handlers
Â  Â  Â  Â  Â  Â  tr.dataset.resultIndex = results.indexOf(r);

Â  Â  Â  Â  Â  Â  // ... (rest of the row creation is the same)
Â  Â  Â  Â  Â  Â  const tdEmail = document.createElement("td");
Â  Â  Â  Â  Â  Â  tdEmail.innerHTML = `<div class="email">${r.email}</div><div class="muted">${r.name}</div>`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const tdFound = document.createElement("td");
Â  Â  Â  Â  Â  Â  tdFound.innerHTML = `<div style="font-weight:800; font-size: 18px;">${r.found}</div>`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const tdSources = document.createElement("td");
Â  Â  Â  Â  Â  Â  tdSources.textContent = r.sources.length ? r.sources[0] : "-";
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const pct = Math.round((r.found / maxFound) * 100);
Â  Â  Â  Â  Â  Â  const tdScore = document.createElement("td");
Â  Â  Â  Â  Â  Â  tdScore.innerHTML = `<div class="microbar"><i style="width:0%"></i></div>`;

Â  Â  Â  Â  Â  Â  tr.appendChild(tdEmail);
Â  Â  Â  Â  Â  Â  tr.appendChild(tdFound);
Â  Â  Â  Â  Â  Â  tr.appendChild(tdSources);
Â  Â  Â  Â  Â  Â  tr.appendChild(tdScore);
Â  Â  Â  Â  Â  Â  tbody.appendChild(tr);

Â  Â  Â  Â  Â  Â  // Animate bar
Â  Â  Â  Â  Â  Â  setTimeout(()=> setBar(tdScore, pct), 100 + idx*30);

Â  Â  Â  Â  Â  Â  // *** Use CLICK event for stable card display ***
Â  Â  Â  Â  Â  Â  tr.addEventListener("click", (ev)=>{
Â  Â  Â  Â  Â  Â  Â  showRichTooltip(r, ev);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  });
Â  Â  };

Â  Â  // Sort initially by leaks (desc)
Â  Â  results.sort((a,b)=> b.found - a.found);
Â  Â  renderTableRows(results);


Â  Â  // --- Charting Logic --- (Kept original logic)
Â  Â  const barCtx = document.getElementById("barChart").getContext("2d");
Â  Â  const top10Results = results.slice(0, 10);
Â  Â  const barLabels = top10Results.map(r=> r.email.split('@')[0]); 
Â  Â  const barData = top10Results.map(r=> r.found);
Â  Â  const barColors = top10Results.map(r=> r.found>0 ? "#60a5fa" : "#1f2937");
Â  Â  new Chart(barCtx, {
Â  Â  Â  type: "bar",
Â  Â  Â  data: { labels: barLabels, datasets: [{ label: "Leaks per email (Top 10)", data: barData, backgroundColor: barColors }] },
Â  Â  Â  options:{ responsive:true, maintainAspectRatio: false, plugins:{legend:{display:false}}, scales:{x:{ticks:{color: '#e6eef6', maxRotation: 45, minRotation: 45}}, y:{beginAtZero:true, ticks:{color: '#e6eef6'}}}, layout: { padding: { top: 10 } }}
Â  Â  });

Â  Â  const donutCtx = document.getElementById("donutChart").getContext("2d");
Â  Â  new Chart(donutCtx, {
Â  Â  Â  type: "doughnut",
Â  Â  Â  data: {
Â  Â  Â  Â  labels: ["Accounts Leaked", "Accounts Safe"],
Â  Â  Â  Â  datasets: [{ data: [leakedCount, total - leakedCount], backgroundColor:["#60a5fa","#2dd4bf"] }]
Â  Â  Â  },
Â  Â  Â  options:{
Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  plugins:{
Â  Â  Â  Â  Â  Â  Â  legend:{position:"bottom", labels: {color: '#e6eef6'}},
Â  Â  Â  Â  Â  Â  Â  tooltip:{callbacks: { label: (c) => `${c.label}: ${c.formattedValue} (${((c.raw / total) * 100).toFixed(1)}%)` }}
Â  Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  });

Â  Â  // top sources list
Â  Â  const topList = document.getElementById("top-sources-list");
Â  Â  if (topSources.length===0) topList.innerHTML = '<div class="muted">No sources detected</div>';
Â  Â  else topList.innerHTML = topSources.map(s=>
Â  Â  Â  `<div style="font-weight:700; font-size: 16px;">${s[0]}</div>
Â  Â  Â  Â <div class="muted" style="margin-bottom: 8px;">${s[1]} occurrences</div>`
Â  Â  ).join("<hr style='border:none;border-top:1px dashed rgba(255,255,255,0.08);margin:12px 0'>");


Â  Â  // --- Search & Sort Behavior ---
Â  Â  const filterAndSort = () => {
Â  Â  Â  Â  hideTooltip(); // Hide tooltip on filter/sort change
Â  Â  Â  Â  const q = document.getElementById("search").value.toLowerCase();
Â  Â  Â  Â  const val = document.getElementById("sort").value;
Â  Â  Â  Â  let filtered = results.filter(r => {
Â  Â  Â  Â  Â  Â  const sourceNames = r.sources.join(' ').toLowerCase();
Â  Â  Â  Â  Â  Â  const rowText = `${r.email} ${r.name} ${sourceNames}`;
Â  Â  Â  Â  Â  Â  return rowText.includes(q);
Â  Â  Â  Â  });

Â  Â  Â  Â  if (val === "leaks_desc") filtered.sort((a,b)=>b.found - a.found);
Â  Â  Â  Â  else if (val === "leaks_asc") filtered.sort((a,b)=>a.found - b.found);
Â  Â  Â  Â  else if (val === "alpha") filtered.sort((a,b)=> a.email.localeCompare(b.email));

Â  Â  Â  Â  renderTableRows(filtered);
Â  Â  };

Â  Â  document.getElementById("search").addEventListener("input", filterAndSort);
Â  Â  document.getElementById("sort").addEventListener("change", filterAndSort);

Â  })(); 
Â  </script>
</body>
</html>